```{r setup}
library(tibble)
library(tidyr)
library(ggplot2)
library(ggdist)
library(dplyr)
library(readr)
library(lubridate)
library(here)
library(patchwork)
library(showtext)

font_add_google("Roboto Condensed", "Roboto")
windowsFonts("Roboto Condensed" = windowsFont("Roboto Condensed"))
theme_set(theme_ggdist())
clrs <- c("#5778a4", "#ff001e", "#e49444")
clrs_2 <- c("blue" = "#5778a4", "red" = "#e49444", "green" = "#6a9f58")
```


## Continuous speech, discrete units

![From @meyer2018neural.](assets/multilevel.jpg)

::: {.notes}
- We are focusing on one of the first and most critical steps in language acquisition: chunking the continuous speech stream into discrete, linguistically relevant units.
:::

## The syllable: a privileged linguistic unit?

Newborns (and adults) preferentially parse the speech signal into [syllable-sized units]{style="background-color: #e3e1e1;"} [e.g., @bijeljac19934; @flo2022sleeping; @luo2007phase; @jusczyk1987representation; @bertoncini1988investigation]

![From @flo2022sleeping.](assets/entrainment.png)

::: {.notes}
- Syllables seem to be specially important during the first stages of language acquisition
- Newborns preferentially parse speech into syllables (as opposed to individual phonemes, words, or phrases)
- What makes syllables so special? 
:::



## Syllabic structure

::: {.columns}
::: {.column width="40%"}
![](assets/structure.png)
:::
::: {.column width="60%"}
|Structure |Onset  |Nucleus  |Coda  |
|----------|:-----:|:-------:|:----:|
| V        |       |a        |      |
| CV       | t     |a        |      |
| CVC      | t     |a        |n     |
| VC       |       |a        |n     |
:::
:::

::: {.notes}
- Same examples of syllables
:::


## Language-specific constraints to syllabic structure

| Structure | Japanese     | Spanish          | English         |
|-----------|--------------|------------------|-----------------|
|V          | [u]{style="background-color: #e3e1e1;"}.mi     | [o]{style="background-color: #e3e1e1;"}.jo         | [a]{style="background-color: #e3e1e1;"}.ny        |
|CV         | [ya]{style="background-color: #e3e1e1;"}.ma.ha | [ca]{style="background-color: #e3e1e1;"}.sa        | [fai]{style="background-color: #e3e1e1;"}.ry      | 
|CVC        | [hon]{style="background-color: #e3e1e1;"}.da   | [rin]{style="background-color: #e3e1e1;"}.cón      | [con]{style="background-color: #e3e1e1;"}.trol    |
|CCVC       |              | [fres]{style="background-color: #e3e1e1;"}.co      | [fresh]{style="background-color: #e3e1e1;"}       |
|CCVCC      |              | [trans]{style="background-color: #e3e1e1;"}.por.te | [shrink]{style="background-color: #e3e1e1;"}     |
|CCCVCCC    |              |                  | [strengths]{style="background-color: #e3e1e1;"}   |


::: {.notes}
- Not all syllabic structures are possible in all languages
- Some languages impose stricter phonotactical constraints on the specific sounds and number of sounds that can occur at onset or coda
:::


## Maximal Onset Principle (MOP)

::: box

Consonants are preferably grouped at syllabic onset
:::

* [MOP+]{style="background-color: #5778a4; color: white"}: CV.CCV - /mo.pla/
* [MOP-]{style="background-color: #e49444; color: white"}: CVC.CV - /mop.la/

::: {.notes}
- However, some constraints to syllabic structure seem to be universal
- Universal: most, if not all languages, show a preference for following some specific constraints
- The aim of this project is to investigate the possible role of these universals as an early mechanism for syllabification
:::


## Are newborns sensitive to (violations of) the MOP?

**fNIRS**: differential haemodynamic response^[Relative changes in concentration of oxy-hemoglobin (HbO) and deoxy-hemoglobin (HbR) across time.] to MOP+ and MOP- stimuli.

::: box
**Hypothesis 1**: If newborns are sensitive to violations of the MOP, the haemodynamic responses to MOP+ and MOP- words should differ (morphology of the signal).
:::

[mo.pla]{style="background-color: #5778a4; color: white"} $\neq$ [mop.la]{style="background-color: #e49444; color: white"}

## Are newborns sensitive to (violations of) the MOP?

::: box
**Hypothesis 2**: If newborns have an innate preference for MOP+ structures, the haemodynamic response to MOP+ words should be *greater* than for MOP- words (max. amplitude, AUC, time-to-peak). (?)
:::

[mo.pla]{style="background-color: #5778a4; color: white"} $\gt$ [mop.la]{style="background-color: #e49444; color: white"}

## Are newborns sensitive to (violations of) the MOP?

::: box
**Hypothesis 3**: If newborns discriminate between MOP+ and MOP- (Hypothesis 1), they do so by processing the disyllabic structure of the word (not just the first syllable).
:::

[mop.pla]{style="background-color: #e49444; color: white"} $\neq$ [mop]{style="background-color: #6a9f58; color: white"}


## Participants

```{r}
#| label: import-paricipants
participants <- read_csv2(here("data", "participants.csv"), show_col_types = FALSE) |>
  mutate(date_test = as_date(date_test, format = "%Y-%m-%dT%H:%M"))
```

* Healthy, full term neonates.^[Last Apgar score $\geq$ 9, $\geq$ 37 gestation weeks, $\geq$ 2,700g birth weight.]
* Born at the Àrea de Maternitat form Hospital Sant Joan de Déu (Barcelona), tested in their room.

```{r}
#| label: fig-participants
#| fig-cap: Participant information.
#| fig-width: 7
#| fig-height: 2

get_age_hours <- function(months, days, hours, minutes) {
  min_h <- ifelse(is.na(minutes), 0, minutes / 60)
  day_h <- ifelse(is.na(days), 0, days * 24)
  mon_h <- ifelse(is.na(months), 0, months * 24 * 30.345)
  return(mon_h + day_h + hours + min_h)
}

participants_plot_data <- read_csv2(here("data", "participants.csv"), show_col_types = FALSE) |>
  filter(!(is.na(age_months) & !is.na(age_days) & !is.na(age_hours) & !is.na(age_min))) |>
  mutate(
    age = get_age_hours(age_months, age_days, age_hours, age_min),
    across(c(age_hours, gest_weeks), floor)
  )


ggplot(participants_plot_data, aes(age)) +
  geom_dots(layout = "weave", na.rm = TRUE, fill = clrs[1], colour = "white") +
  geom_vline(xintercept = mean(participants_plot_data$age, na.rm = TRUE, colour = "black", linewidth = 2)) +
  labs(title = "Age (hours)") +
  ggplot(participants_plot_data, aes(birth_weight)) +
  geom_dots(layout = "weave", na.rm = TRUE, fill = clrs[1], colour = "white") +
  geom_vline(xintercept = mean(participants_plot_data$birth_weight, na.rm = TRUE, colour = "black", linewidth = 2)) +
  labs(title = "Birth weight (g)") +
  ggplot(participants_plot_data, aes(gest_weeks)) +
  geom_dots(na.rm = TRUE, fill = clrs[1], colour = "white") +
  geom_vline(xintercept = mean(participants_plot_data$gest_weeks, na.rm = TRUE, colour = "black", linewidth = 2)) +
  labs(title = "Gestation weeks") &
  plot_layout() &
  theme(
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
  )
```

::: {.notes}
- We will run an experimental series that involves neonates and infants
- Neonates will be tested using fNIRS, while infants will be tested using fNIRS and behavioural tasks (like the HeadTurn Preference Procedure)
- I will focus on the fNIRS testing of neonates and infants, as they follow the same task design
- Ideally, we'd like to test up to 50 participants per experiment, although power analysis is pending
- Most of our participants will have a Catalan and/or Spanish background
:::

## Participants

```{r}
pilot_dates <- participants |>
  summarise(
    across(where(is.Date), list(min, max), .names = "{.col}_{.fn}"),
    .by = pilot
  )
excluded <- participants |>
  filter(!pilot, !include) |>
  mutate(
    exc_crying = grepl("crying", tolower(comments)),
    exc_capping = grepl("bad capping", tolower(comments))
  ) |>
  summarise(across(starts_with("exc_"), sum))
```

* **Pilot** (`r pilot_dates$date_test_1[1]`--`r pilot_dates$date_test_2[1]`): `r sum(participants$pilot, na.rm = TRUE)`: Participants.
* **Experiment** (`r pilot_dates$date_test_1[1]`--now): `r sum(!participants$pilot)`.
    - Excluded (< 10 min.): `r excluded$exc_crying` crying, `r excluded$exc_capping` bad capping.
    - Provided valid data: `r sum(!participants$pilot & participants$include)`
    - Data quality ranges a lot between participants

## Testing setup and procedure

## Stimuli

**CVCCV words**: Onset + Vowel + Consonant cluster (CC) + Vowel

| **List**   | **Syllabification** | **Words**                      |
|------------|---------------------|--------------------------------|
| List 1     | [ST (CV-CCV)]{style="background-color: #5778a4; color: white"}         | MO-PLA, SA-KLO, TI-PLE, DE-KLI | 
|            | [DW (CVC-CV)]{style="background-color: #e49444; color: white"}         | MOP-LA, SAK-LO, TIP-LE, DEK-LI | 
|            | [DS (CVC)]{style="background-color: #6a9f58; color: white"}            | MOP, SAK, TIP, DEK             |
| List 2     | [ST (CV-CCV)]{style="background-color: #5778a4; color: white"}         | MO-KLA, SA-PLO, TI-KLE, DE-PLI |
|            | [DW (CVC-CV)]{style="background-color: #e49444; color: white"}         | MOK-LA, SAP-LO, TIK-LE, DEP-LI |
|            | [DS (CVC)]{style="background-color: #6a9f58; color: white"}            | MOK, SAP, TIK, DEP             |
: Stimuli lists. {#tbl-stimuli}

## Stimuli

* Synthesised using MBROLA  (`it4` voice) (*pymbrola* Python package)
* 25 ms pause between syllables
* Constant prosody: 200 Hz F0
* Manually removed offset voicing from CVC syllables (Praat)

## Block design

![](assets/design.jpg)


## Data analysis

MNE-NIRS (Python):

1) Light intensity to **optical density**
2) Automatic **channel rejection** based (SCI $\geq$ .80)
3) **Motion arctifact correction** (TDDR)
4) Calculate **$\Delta$HbO and $\Delta$HbO** using the modified Beer-Lambert Law
5) Band-pass **filter** (0.01-1.0 Hz)
6) **Block epoching** (-5 to 30 seconds), baseline correction, linear detrend
7) **Block averaging**
8) **Participant rejection** ($\geq$ 2 trials per condition)

# Results

Haemodynamic response averaged across blocks, channels, and participants.

[HbO]{style="background-color: #d1615d; color: white"} [HbR]{style="background-color: #5778a4; color: white"}
![](assets/evoked-condition.png)

# Results

Haemodynamic response averaged across blocks, channels, and participants.

[ST]{style="background-color: #5778a4; color: white"} [DW]{style="background-color: #e49444; color: white"} [DS]{style="background-color: #6a9f58; color: white"}
![](assets/evoked-chromo.png)

# Results

Haemodynamic response averaged across blocks and participants.

![](assets/evoked-topo-hbo.png)

# Results

Haemodynamic response averaged across blocks and participants.

![](assets/evoked-spatial.png)


# Discussion

So far:

* Testing protocol done
* fNIRS setup up and running
* Data processing pipeline almost ready

# Discussion

Next steps:

* Finish data collection: 30-40 participants.
* Statistical modelling:
  - Time-domain analysis: Cluster-based permutation testing
  - Waveform analysis: Bayesian GAMMs
  - Summary statistics: Peak amplitude, AUC, time-to-peak

## {background-image="assets/thanks.png"}

# Appendix

## NIRS setup

* NIRSport2 (NIRx), CW 760 nm & 850 nm
* Sampling frequency 20.345 Hz (~0.05 s samples)
* NIRScap: 8 channels LH, 8 channels RH

## References


